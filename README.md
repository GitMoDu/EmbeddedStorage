# EmbeddedStorage

Abstractions for storing, reading and managing data structs and arrays in EEPROM, inspired by Arduino EEPROMWearLevel Library.

## Features:
  - CRC validated data.
  - Templated StorageUnit, with a common interface for startup constants (address and size).
  - Wear levelling options (thank you @PRosenb https://github.com/PRosenb/EEPROMWearLevel).
  - Optional run-time bounds check with EEPROM_BOUNDS_CHECK.
  - Support for ATTiny85.
  - Static setup-time address allocator, for setup with multiple units in one project.

## Dependencies:
  - FastCRC: https://github.com/FrankBoesing/FastCRC
  - Arduino EEPROM
    - https://www.arduino.cc/en/Reference/EEPROM


## References
Special mention for Arduino EEPROMWearLevel Library flash twidling bits.
  - https://github.com/PRosenb/EEPROMWearLevel/blob/master/src/avr/EEPROMWearLevelAvr.cpp


## Library:
  - StorageUnit
    - Templated size and key.
    - Start address is passed on constructor.
    - CRC validated data.
    - CRC seed Key is optional and can be used for versioning. Defaults to Key = size.
    - 1 byte of EEPROM overhead.

  - WearLevelUnit
    - Same base features as StorageUnit.
    - 1 byte of EEPROM overhead per level option, plus counter.
    - 1 to 2 bytes of counter EEPROM overhead.
    - Wear levelling options start at x2. For x1 use StorageUnit.
    - Wear level units:
      - Tiny: from x2 to x8 levels of data. 1 extra byte of EEPROM overhead.
      - Short: from x9 to x16 levels of data. 2 extra bytes of EEPROM overhead.



# Unit Testing Output

	Embedded Storage Unit Test Start
	
	
	Testing Mock Storage Attributor:
		Used	Free	Total
		17	186	203
		Validated.
	
	Testing TestUnits Storage Attributor:
		Used	Free	Total
		203	0	203
		Validated.
	
	Testing Storage Unit:
		Validated.
	Testing Wear Level Tiny2 Unit:
		Erase 0b11111111
		Reset 0b00000000
			0	 0b11111111
			1	 0b01111111
		End 0b11111111
		Validated.
	Testing Wear Level Tiny9 Unit:
		Erase 0b11111111
		Reset 0b00000000
			0	 0b11111111
			1	 0b01111111
			2	 0b00111111
			3	 0b00011111
			4	 0b00001111
			5	 0b00000111
			6	 0b00000011
			7	 0b00000001
			8	 0b00000000
		End 0b11111111
		Validated.
	Testing Wear Level Short10 Unit:
		Erase 0b1111111111111111
		Reset 0b0000000000000000
			0	 0b1111111111111111
			1	 0b0111111111111111
			2	 0b0011111111111111
			3	 0b0001111111111111
			4	 0b0000111111111111
			5	 0b0000011111111111
			6	 0b0000001111111111
			7	 0b0000000111111111
			8	 0b0000000011111111
			9	 0b0000000001111111
		End 0b1111111111111111
		Validated.
	Testing Wear Level Short17 Unit:
		Erase 0b1111111111111111
		Reset 0b0000000000000000
			0	 0b1111111111111111
			1	 0b0111111111111111
			2	 0b0011111111111111
			3	 0b0001111111111111
			4	 0b0000111111111111
			5	 0b0000011111111111
			6	 0b0000001111111111
			7	 0b0000000111111111
			8	 0b0000000011111111
			9	 0b0000000001111111
			10	 0b0000000000111111
			11	 0b0000000000011111
			12	 0b0000000000001111
			13	 0b0000000000000111
			14	 0b0000000000000011
			15	 0b0000000000000001
			16	 0b0000000000000000
		End 0b1111111111111111
		Validated.
	Testing Wear Level Long18 Unit:
		Erase 0b11111111111111111111111111111111
		Reset 0b00000000000000000000000000000000
			0	 0b11111111111111111111111111111111
			1	 0b01111111111111111111111111111111
			2	 0b00111111111111111111111111111111
			3	 0b00011111111111111111111111111111
			4	 0b00001111111111111111111111111111
			5	 0b00000111111111111111111111111111
			6	 0b00000011111111111111111111111111
			7	 0b00000001111111111111111111111111
			8	 0b00000000111111111111111111111111
			9	 0b00000000011111111111111111111111
			10	 0b00000000001111111111111111111111
			11	 0b00000000000111111111111111111111
			12	 0b00000000000011111111111111111111
			13	 0b00000000000001111111111111111111
			14	 0b00000000000000111111111111111111
			15	 0b00000000000000011111111111111111
			16	 0b00000000000000001111111111111111
			17	 0b00000000000000000111111111111111
		End 0b11111111111111111111111111111111
		Validated.
	Testing Wear Level Long33 Unit:
		Erase 0b11111111111111111111111111111111
		Reset 0b00000000000000000000000000000000
			0	 0b11111111111111111111111111111111
			1	 0b01111111111111111111111111111111
			2	 0b00111111111111111111111111111111
			3	 0b00011111111111111111111111111111
			4	 0b00001111111111111111111111111111
			5	 0b00000111111111111111111111111111
			6	 0b00000011111111111111111111111111
			7	 0b00000001111111111111111111111111
			8	 0b00000000111111111111111111111111
			9	 0b00000000011111111111111111111111
			10	 0b00000000001111111111111111111111
			11	 0b00000000000111111111111111111111
			12	 0b00000000000011111111111111111111
			13	 0b00000000000001111111111111111111
			14	 0b00000000000000111111111111111111
			15	 0b00000000000000011111111111111111
			16	 0b00000000000000001111111111111111
			17	 0b00000000000000000111111111111111
			18	 0b00000000000000000011111111111111
			19	 0b00000000000000000001111111111111
			20	 0b00000000000000000000111111111111
			21	 0b00000000000000000000011111111111
			22	 0b00000000000000000000001111111111
			23	 0b00000000000000000000000111111111
			24	 0b00000000000000000000000011111111
			25	 0b00000000000000000000000001111111
			26	 0b00000000000000000000000000111111
			27	 0b00000000000000000000000000011111
			28	 0b00000000000000000000000000001111
			29	 0b00000000000000000000000000000111
			30	 0b00000000000000000000000000000011
			31	 0b00000000000000000000000000000001
			32	 0b00000000000000000000000000000000
		End 0b11111111111111111111111111111111
		Validated.
	
	
	All tests passed.
	
	
	
	     :
	 '.  _  .'
	-=  (~)  =-
	 .'  #  '.

